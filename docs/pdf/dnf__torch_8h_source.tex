\doxysection{dnf\+\_\+torch.\+h}
\hypertarget{dnf__torch_8h_source}{}\label{dnf__torch_8h_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#ifndef\ \_DNF\_H}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ \_DNF\_H}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <torch/torch.h>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <deque>}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#ifdef\ NDEBUG}}
\DoxyCodeLine{00020\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ debugOutput\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00022\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ debugOutput\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classDelayLine}{DelayLine}}\ \{}
\DoxyCodeLine{00026\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{keywordtype}{void}\ init(\textcolor{keywordtype}{int}\ delaySamples)\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ delaySamples\_\ =\ delaySamples;}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ buffer\_\ =\ std::deque<float>(delaySamples\_,\ 0.0f);}
\DoxyCodeLine{00030\ \ \ \ \ \}}
\DoxyCodeLine{00031\ \ \ \ \ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ process(\textcolor{keywordtype}{float}\ input)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ output\ =\ buffer\_.front();}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ buffer\_.pop\_front();}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ buffer\_.push\_back(input);}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ output;}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \ \ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{keywordtype}{float}\ get(\textcolor{keywordtype}{int}\ i)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordflow}{return}\ buffer\_[i];}
\DoxyCodeLine{00041\ \ \ \ \ \}}
\DoxyCodeLine{00042\ \ \ \ \ }
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordtype}{float}\ getNewest()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{return}\ buffer\_.back();}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \ \ \ \ }
\DoxyCodeLine{00047\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{int}\ delaySamples\_\ =\ 0;}
\DoxyCodeLine{00049\ \ \ \ \ std::deque<float>\ buffer\_;}
\DoxyCodeLine{00050\ \};}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classDNF}{DNF}}\ \{}
\DoxyCodeLine{00059\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{classDNF_a73ba107ad8339d3107a753a2a424f296}{ActMethod}}\ \{Act\_Sigmoid\ =\ 1,\ Act\_Tanh\ =\ 2,\ Act\_ReLU\ =\ 3,\ Act\_NONE\ =\ 0\};}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keyword}{struct\ }Net\ :\ \textcolor{keyword}{public}\ torch::nn::Module\ \{}
\DoxyCodeLine{00068\ \ \ \ \ std::vector<torch::nn::Linear>\ fc;}
\DoxyCodeLine{00069\ \ \ \ \ Net(\textcolor{keywordtype}{int}\ nLayers,\ \textcolor{keywordtype}{int}\ nInput,\ \textcolor{keywordtype}{bool}\ withBias\ =\ \textcolor{keyword}{false});}
\DoxyCodeLine{00070\ \ \ \ \ torch::Tensor\ forward(torch::Tensor\ x,\ \mbox{\hyperlink{classDNF_a73ba107ad8339d3107a753a2a424f296}{ActMethod}}\ am);}
\DoxyCodeLine{00071\ \ \ \ \ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{classDNF_aa0a6a4321fc8e93e1a6407b9a72b66bd}{DNF}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nLayers,}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ nTaps,}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ samplingrate,}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDNF_a73ba107ad8339d3107a753a2a424f296}{ActMethod}}\ am\ =\ Act\_Tanh,}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{bool}\ tryGPU\ =\ \textcolor{keyword}{false}}
\DoxyCodeLine{00089\ \ \ \ \ );}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ setLearningRate(\textcolor{keywordtype}{float}\ mu)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{auto}\&\ group\ :\ optimizer-\/>param\_groups())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{static\_cast<}torch::optim::SGDOptions\&\textcolor{keyword}{>}(group.options()).lr(mu);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classDNF_a42f97624184f136324b094b6dba0cfb0}{filter}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ signal,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ noise);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classDNF_a8323c9fd3bd4757124242b43fad72f98}{getSignalDelaySteps}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordflow}{return}\ signalDelayLineLength;}
\DoxyCodeLine{00112\ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ }
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classDNF_afe4ca00a5c6f304ac24cf0ae2ec0dd34}{getDelayedSignal}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordflow}{return}\ signal\_delayLine.get(0);}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \ \ }
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classDNF_aad961eded5bd6616323ad6eb562294c2}{getRemover}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{return}\ remover;}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classDNF_a1cb9c612383fc04383a1d8d3585e3ba3}{getOutput}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{return}\ f\_nn;}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ \ \ \ \ }
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classDNF_ab7ca529281584cc9c5689527155e2e72}{\string~DNF}}()\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keyword}{delete}\ optimizer;}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keyword}{delete}\ model;}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \ \ \ \ std::vector<float>\ \mbox{\hyperlink{classDNF_aeb6e5b55bbd310a1152b4e39fc6855b1}{getLayerWeightDistances}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{classDNF_a533c774412b0d608333cfb2840bc9990}{getWeightDistance}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00159\ \ \ \ \ }
\DoxyCodeLine{00160\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordtype}{void}\ saveInitialParameters()\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \textcolor{keyword}{auto}\&\ p\ :\ model-\/>parameters())\ \{\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ initialParameters.push\_back(p.detach().clone());}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ Net*\ model\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00169\ \ \ \ \ torch::optim::SGD*\ optimizer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00170\ \ \ \ \ std::vector<torch::Tensor>\ initialParameters;}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ noiseDelayLineLength;}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ signalDelayLineLength;}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ fs;}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDNF_a73ba107ad8339d3107a753a2a424f296}{ActMethod}}\ actMethod;}
\DoxyCodeLine{00175\ \ \ \ \ \mbox{\hyperlink{classDelayLine}{DelayLine}}\ signal\_delayLine;}
\DoxyCodeLine{00176\ \ \ \ \ \mbox{\hyperlink{classDelayLine}{DelayLine}}\ noise\_delayLine;}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordtype}{float}\ remover\ =\ 0;}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{float}\ f\_nn\ =\ 0;}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{constexpr}\ \textcolor{keywordtype}{double}\ xavierGain\ =\ 0.01;}
\DoxyCodeLine{00180\ \ \ \ \ torch::Device\ device\ =\ torch::kCPU;}
\DoxyCodeLine{00181\ \};}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
